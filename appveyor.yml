# Build worker image (VM template)
image: Visual Studio 2017

#environment:
#  access_token:
#    secure: abc

# Build Pipeline Step > Init:
init:
  - ps: $date = Get-Date -UFormat "%d_%m_%Y_%H%M"
  - ps: echo $date
  #- set PATH=%PATH%;"C:\\Program Files (x86)\\Inno Setup 5"

# Build Pipeline Step > Install additional software:
#install:  
  
# Build Pipeline Step > Build:
build_script:
  # Fetch Components, Generate "downloads\versions.txt", Generate "installer\install.iss"
  - build-tools\php\php.exe build-tools\build.php
  # List Downloads
  - ls -lhs downloads
  # Build Installer
  - build-tools\InnoSetup6\iscc.exe installer\Reaper-Toolbox.iss
  # List Release Folder
  - ls -lhs release

# Define Deployment Artifacts
artifacts:
  - path: '/release/*.exe'
    name: Installer-Executable

# Deployment (Appveyor to Github Releases)
deploy:
  provider: GitHub
  release: Reaper-Toolbox-v$(appveyor_build_version)
  #description: 'Reaper-Toolbox-v$(appveyor_build_version)'  
  artifact: Installer-Executable
  draft: false
  prerelease: false
  force_update: true            # overwrite files of existing release on GitHub
  on:
    branch: master              # release from master branch only
    APPVEYOR_REPO_TAG: true     # deploy on tag push only
  auth_token:
    secure: J8ppEUaj+/rG+CIAz9xf996MHAJd+etyniwSPbdINFT4aBSpULhUtBsUr14DxUwq
